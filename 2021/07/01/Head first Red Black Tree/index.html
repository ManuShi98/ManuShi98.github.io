<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="红黑树," />










<meta name="description" content="Red-Black Tree is a special kind of binary search tree. Each of its node is either black or red. Besides, the Red-Black tree has the following features:  Each of its nodes is either black or red. The">
<meta property="og:type" content="article">
<meta property="og:title" content="Head first Red Black Tree">
<meta property="og:url" content="https://manushi98.github.io/2021/07/01/Head%20first%20Red%20Black%20Tree/index.html">
<meta property="og:site_name" content="ManuShi98">
<meta property="og:description" content="Red-Black Tree is a special kind of binary search tree. Each of its node is either black or red. Besides, the Red-Black tree has the following features:  Each of its nodes is either black or red. The">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2021/06/22/dGXA48Cs2cyHUhn.png">
<meta property="og:image" content="https://i.loli.net/2021/06/22/6BUOLIxCZvDbRHf.png">
<meta property="og:image" content="https://i.loli.net/2021/06/24/LTPAKGR7JqMwDQX.png">
<meta property="og:image" content="https://i.loli.net/2021/06/24/nrmYzwAZdc19yH6.png">
<meta property="og:image" content="https://i.loli.net/2021/06/24/aeuvXC4MoAlRNjQ.png">
<meta property="og:image" content="https://i.loli.net/2021/06/24/k1EKLdy42CgzBwl.png">
<meta property="og:image" content="https://i.loli.net/2021/06/30/T1DEtHJNeduVsMF.png">
<meta property="og:image" content="https://i.loli.net/2021/06/30/lisTtoB7Ve2SPxH.png">
<meta property="og:image" content="https://i.loli.net/2021/06/30/JIXPar5LxScsQ6i.png">
<meta property="og:image" content="https://i.loli.net/2021/07/01/p5DAXYMevbGUSnq.png">
<meta property="article:published_time" content="2021-07-01T07:57:35.000Z">
<meta property="article:modified_time" content="2021-07-01T08:03:44.000Z">
<meta property="article:author" content="ManuShi98">
<meta property="article:tag" content="红黑树">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/06/22/dGXA48Cs2cyHUhn.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://manushi98.github.io/2021/07/01/Head first Red Black Tree/"/>





  <title>Head first Red Black Tree | ManuShi98</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?94593197e4ba33bda8502d17ada6f52e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ManuShi98</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">真彩希帆のファン</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://manushi98.github.io/2021/07/01/Head%20first%20Red%20Black%20Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2020/12/14/8mG9PknVTAeH4cf.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ManuShi98">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Head first Red Black Tree</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-01T00:57:35-07:00">
                2021-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BA%A2%E9%BB%91%E6%A0%91/" itemprop="url" rel="index">
                    <span itemprop="name">红黑树</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Red-Black Tree is a special kind of binary search tree. Each of its node is either black or red. Besides, the Red-Black tree has the following features:</p>
<ul>
<li>Each of its nodes is either black or red.</li>
<li>The root node is black.</li>
<li>Every leaf node is black. (In the Red-Black tree, the leaf node is a NIL node).</li>
<li>If a node is red, its child must be black.</li>
<li>From any node to its descendant leaf node must have the same number of black nodes. </li>
</ul>
<p>The reason why we use the Red-Black tree that it’s height is always log(n), which guarantees the time complexity of its operation. The proof of Red-Black Tree’s time complexity can be found <a target="_blank" rel="noopener" href="https://www.cnblogs.com/skywang12345/p/3245399.html">here</a>. </p>
<span id="more"></span>

<h1 id="An-Implementation-of-the-Red-Black-tree-in-C"><a href="#An-Implementation-of-the-Red-Black-tree-in-C" class="headerlink" title="An Implementation of the Red-Black tree in C++"></a>An Implementation of the Red-Black tree in C++</h1><p>To help understand the Red-Black tree better, implementing the Red-Black tree is a good way.</p>
<h2 id="The-node-of-the-Red-Black-tree"><a href="#The-node-of-the-Red-Black-tree" class="headerlink" title="The node of the Red-Black tree"></a>The node of the Red-Black tree</h2><h3 id="The-structure-of-the-node"><a href="#The-structure-of-the-node" class="headerlink" title="The structure of the node"></a>The structure of the node</h3><p>First, we should consider the structure of the RB tree’s node. According to the features of the Red-Black tree, the node of  Red-Black tree should contain the value, color, pointers of its child and parent. So we can get code like this:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The color of RB Tree&#x27;s node. I use enum type here to make code much easier to read.</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RBTNodeColor</span>&#123;</span></span><br><span class="line">    RED,</span><br><span class="line">    BLACK</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// The relation between the node and its sons.</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RBTRelation</span>&#123;</span></span><br><span class="line">    LEFT,</span><br><span class="line">    RIGHT,</span><br><span class="line">    ERROR</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use generics to make it easy to use.</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T value;</span><br><span class="line">    RBTNodeColor color;<span class="comment">//RED or BLACK</span></span><br><span class="line">    RBTNode&lt;T&gt; *child[<span class="number">2</span>], *parent;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="The-operation-of-the-node"><a href="#The-operation-of-the-node" class="headerlink" title="The operation of the node"></a>The operation of the node</h3><p>As a good programmer we should use getter and setter.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RBTNode</span>(T value, RBTNodeColor color = BLACK, RBTNode&lt;T&gt; *left = <span class="literal">NULL</span>, RBTNode&lt;T&gt; *right = <span class="literal">NULL</span>, RBTNode&lt;T&gt; *parent = <span class="literal">NULL</span>) : <span class="built_in">value</span>(value), <span class="built_in">color</span>(color), <span class="built_in">parent</span>(parent)&#123;</span><br><span class="line">        child[<span class="number">0</span>] = left, child[<span class="number">1</span>] = right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Use getSon(LEFT) or getSon(RIGHT) to access the sons.</span></span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">getSon</span><span class="params">(RBTRelation relation)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;child[relation];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setSon</span><span class="params">(RBTNode&lt;T&gt; *node, RBTRelation relation)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;child[relation] = node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">getParent</span><span class="params">()</span></span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTNode&lt;T&gt; *parent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNodeColor <span class="title">getRBTNodeColor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRBTNodeColor</span><span class="params">(RBTNodeColor color)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;color = color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTRelation <span class="title">getRelation</span><span class="params">(RBTNode *parent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(LEFT) == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> LEFT;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(RIGHT) == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> RIGHT;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">T <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Good! Now the structure of RB tree is done. We can move to the next step.</p>
<h2 id="RB-Tree"><a href="#RB-Tree" class="headerlink" title="RB Tree"></a>RB Tree</h2><p>To make the code look much tidier, I use a class to symbolize the RB tree.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTree</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    RBTNode&lt;T&gt; *root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Keep in mind that we should always record the root of the tree(For all the binary search tree), or nobody will know which node we should begin with while searching. </p>
<h3 id="Rotate"><a href="#Rotate" class="headerlink" title="Rotate"></a>Rotate</h3><p>Rotate is the basic operation of the binary search tree. I’ve read many books that tend to use “Left Rotate” and “Right Rotate”. In my opinion, this makes things too complex. Before looking at the following picture, I hope you know that Enum in C++ can be present as Integer. For example the RBTRelation I’ve defined before means LEFT = 0, RIGHT = 1, ERROR = 2. In the following picture, I will use Integers to present the relationship between parent and sons.(The ? means we don’t make any changes to this node. Actually, we don’t do anything to the sibling as well.).</p>
<p><img src="https://i.loli.net/2021/06/22/dGXA48Cs2cyHUhn.png" alt="RBTree-Left-Rotate.png"></p>
<p><img src="https://i.loli.net/2021/06/22/6BUOLIxCZvDbRHf.png" alt="RBTree-Right-Rotate.png"></p>
<p>Left Rotate and Right Rotate is just like a mirror, right? What’s more, the edges between parent and sibling, son and ? never change. The edges between parent and son, son and grandson seem have a pattern. Let’s make it clear:</p>
<table>
<thead>
<tr>
<th>Left Rotate</th>
<th>Right Rotate</th>
</tr>
</thead>
<tbody><tr>
<td>The relation between parent and son is <strong>RIGHT(1)</strong>.</td>
<td>The relation between parent and son is <strong>LEFT(0)</strong>.</td>
</tr>
<tr>
<td>parent[<strong>RIGHT(1)</strong>] = son[<strong>LEFT(0)</strong>]</td>
<td>parent[<strong>LEFT(0)</strong>] = son[<strong>RIGHT(1)</strong>]</td>
</tr>
<tr>
<td>Gson-&gt;parent = parent</td>
<td>Gson-&gt;parent = parent</td>
</tr>
<tr>
<td>son-&gt;parent = grandparent</td>
<td>son-&gt;parent = grandparent</td>
</tr>
<tr>
<td>if(grandparent==NULL)root = son</td>
<td>if(grandparent==NULL)root = son</td>
</tr>
<tr>
<td>else {relation = parent-&gt;getRelation(grandparent)</td>
<td>else {relation = parent-&gt;getRelation(grandparent)</td>
</tr>
<tr>
<td>grandparent-&gt;son[relation] = son}</td>
<td>grandparent-&gt;son[relation] = son}</td>
</tr>
<tr>
<td>son-&gt;son[<strong>LEFT(0)</strong>] = parent</td>
<td>son-&gt;son[<strong>RIGHT(1)</strong>] = parent</td>
</tr>
<tr>
<td>parent-&gt;parent = son</td>
<td>parent-&gt;parent = son</td>
</tr>
</tbody></table>
<p>Almost the same, right? Even though the relationship maybe a bit different, you can correspond relationship easily. Then we can merge left rotate and right rotate into one function.</p>
<table>
<thead>
<tr>
<th>Rotate</th>
</tr>
</thead>
<tbody><tr>
<td>The relation between parent and son is <strong>Relationship</strong>(0,1). Define <strong>Reverse Relationship</strong> as Relationship^1</td>
</tr>
<tr>
<td>parent[<strong>Relationship</strong>] = son[<strong>Reverse Relationship</strong>]</td>
</tr>
<tr>
<td>Gson-&gt;parent = parent</td>
</tr>
<tr>
<td>son-&gt;parent = grandparent</td>
</tr>
<tr>
<td>if(grandparent==NULL)root = son</td>
</tr>
<tr>
<td>else {relation = parent-&gt;getRelation(grandparent)</td>
</tr>
<tr>
<td>grandparent-&gt;son[relation] = son}</td>
</tr>
<tr>
<td>son-&gt;son[<strong>Reverse Relationship</strong>] = parent</td>
</tr>
<tr>
<td>parent-&gt;parent = son</td>
</tr>
</tbody></table>
<p>Now we can integrate left rotate and right rotate into one function-rotate! Writing two same function is a waste of life.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node, RBTNode&lt;T&gt; *son)</span></span>&#123;</span><br><span class="line">    <span class="comment">/* Initialization:</span></span><br><span class="line"><span class="comment">     *             parent</span></span><br><span class="line"><span class="comment">     *              / (ATTENTION: Maybe left son or right son.)</span></span><br><span class="line"><span class="comment">     *            node</span></span><br><span class="line"><span class="comment">     *           /    \</span></span><br><span class="line"><span class="comment">     *      leftSon    son</span></span><br><span class="line"><span class="comment">     *                /   \</span></span><br><span class="line"><span class="comment">     *            grandSon  ?</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RBTNode&lt;T&gt; *parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">    RBTRelation relation = son-&gt;<span class="built_in">getRelation</span>(node);</span><br><span class="line">    RBTRelation oppRelation = <span class="keyword">static_cast</span>&lt;RBTRelation&gt;(<span class="number">1</span> - relation);</span><br><span class="line">    RBTNode&lt;T&gt; *grandSon = son-&gt;<span class="built_in">getSon</span>(oppRelation);</span><br><span class="line">    node-&gt;<span class="built_in">setSon</span>(grandSon, relation);</span><br><span class="line">    <span class="keyword">if</span> (grandSon != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        grandSon-&gt;<span class="built_in">setParent</span>(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* After the steps before, grandSon is settled.</span></span><br><span class="line"><span class="comment">     *              parent</span></span><br><span class="line"><span class="comment">     *             /</span></span><br><span class="line"><span class="comment">     *           node   &lt;=parent  son</span></span><br><span class="line"><span class="comment">     *           /  \             /     \</span></span><br><span class="line"><span class="comment">     *      leftSon  grandSon        ?</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    son-&gt;<span class="built_in">setParent</span>(parent);</span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        root = son;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        RBTRelation rRelation = node-&gt;<span class="built_in">getRelation</span>(parent);</span><br><span class="line">        <span class="keyword">if</span> (rRelation == ERROR)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ERROR: These two nodes are not parent and son.\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            parent-&gt;<span class="built_in">setSon</span>(son, rRelation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *                  parent</span></span><br><span class="line"><span class="comment">     *                  /</span></span><br><span class="line"><span class="comment">     *             son</span></span><br><span class="line"><span class="comment">     *              /    \</span></span><br><span class="line"><span class="comment">     *           node     ?</span></span><br><span class="line"><span class="comment">     *           /  \ </span></span><br><span class="line"><span class="comment">     *      leftSon  grandSon</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    son-&gt;<span class="built_in">setSon</span>(node, oppRelation);</span><br><span class="line">    node-&gt;<span class="built_in">setParent</span>(son);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we finish the function of ‘rotate’. At the end part of rotate, I’d like to talk about why we need rotate. Many books just tell us to remember rotate and it’s useful, but why? The reason that rotate is useful is first, after rotate, tree is still a VALID binary search tree. The relationships between each nodes are still correct. It’s impossible that after rotate a node’s left son’s value is larger than this node. This is useful while we want to balance a tree and we can adjust the height of tree without worrying about destroy the Binary search tree. Second, rotate enables us to move one node from one subtree to another, lift the current node and put down the parent node. This is useful to RB tree and some other special binary search tree like splay. In the part ‘insert’, you will see how we use rotate to move extra black nodes from one subtree to another.</p>
<h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><p>Insert is a basic operation for all the binary search trees. The only difference is that RB tree need a re-balance after the insert operation. The process of insert is like this:</p>
<ol>
<li>Get the value of Node V.</li>
<li>From the root of the tree,  compare the V and the current node’s value(Begin with root). If V is smaller than the current node’s value, go to the left son of the current node. If V is bigger than the current node’s value, go to the right son of the current node. You should record current node as PARENT because we need it afterwards. Then set current node as the left son(right son). Here we suppose there is no duplicated value in an RB tree. If you want your RB tree contain duplicated value, you can add a property to the node class like “cnt” to count the times of the value. We will stop the loop when the current node is NULL.</li>
<li>Set the parent of node v as PARENT. </li>
<li>If PARENT is not NULL, compare the value of PARENT and the value of node. If the value of node is less than the value of PARENT, set the PARENT’s left son as node, else set the PARENT’s  right son as node. </li>
<li>If PARENT is NULL, set the root as PARENT.</li>
<li>Set the node as RED.</li>
<li>Re-balance the RB Tree. </li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Insert new node</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertNode</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    RBTNode&lt;T&gt; *parent = <span class="literal">NULL</span>;</span><br><span class="line">    RBTNode&lt;T&gt; *cur = root;</span><br><span class="line">    <span class="comment">// Here we want to find the node where we want to insert.</span></span><br><span class="line">    <span class="keyword">while</span> (cur)&#123;</span><br><span class="line">        parent = cur;</span><br><span class="line">        <span class="comment">// Left child&#x27;s value is less than the parent node, right child&#x27;s value is larger than the parent node.</span></span><br><span class="line">        <span class="keyword">if</span> (node-&gt;<span class="built_in">getValue</span>() &lt; cur-&gt;<span class="built_in">getValue</span>())</span><br><span class="line">            cur = cur-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cur = cur-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Here we know the position to insert and also know the parent of the node.</span></span><br><span class="line">    node-&gt;<span class="built_in">setParent</span>(parent);</span><br><span class="line">    <span class="keyword">if</span> (parent != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;<span class="built_in">getValue</span>() &lt; parent-&gt;<span class="built_in">getValue</span>())&#123;</span><br><span class="line">            parent-&gt;<span class="built_in">setSon</span>(node, LEFT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            parent-&gt;<span class="built_in">setSon</span>(node, RIGHT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Don&#x27;t forget the condition that the RBtree is NULL.</span></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        root = node;</span><br><span class="line">    &#125;</span><br><span class="line">    node-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">    <span class="built_in">insertRebalance</span>(root, node);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>Why we choose to set the node as RED? It’s because this will break as fewer rules of the RB tree as possible. Let’s consider the rules of RB tree:</p>
<ul>
<li>Each of its node is either black or red. (YES, we set the new node as RED)</li>
<li>The root node is black.(If at the beginning the tree is empty, we may break this rule).</li>
<li>Every leaf node is black. (In RB tree, the leaf node is a NIL node). (YES, although the node we insert is RED, we set two leaf nodes as BLACK by default).</li>
<li>If a node is red, its child node must be black.(NO, the node we insert is red, and its parent maybe red as well).</li>
<li>From any node to its descendant leaf node must have the same number of black nodes.  (YES, the node we insert is red, which won’t affect the number of black nodes. Be careful that actually we substitute a black node with the red node, that’s why the number of black nodes won’t change).</li>
</ul>
<p>So, we should do two things in the re-balance. First, we should set the root node as black. Second, we should solve the problem that the parent node and child node can’t be both red. To solve this problem, we have to discuss different situations. Here is the first situation.</p>
<p>(1)  Parent is red, uncle is red as well.</p>
<p><img src="https://i.loli.net/2021/06/24/LTPAKGR7JqMwDQX.png" alt="RBTree-insert-rebalance1.png"></p>
<p>Under this situation, the first thing we can do is to change parent to Black. Good! Now we won’t break rule 4. However, this may break rule 5. The black nodes on GParent-Parent-Node plus 1, and is no longer equal to the number of black nodes on GParent-Uncle, not to mention the other part of tree. The only thing we can do is to change uncle to black, and then change GParent to Red. Now at least the sub-tree obeys the rules of RB tree. But there is still possible that GParent’s parent is red. So we need to take GParent as Node and repeat.</p>
<p>P.S. GParent must be black because the RB tree before we insert is valid. So it’s impossible that parent is red and GParent is red as well.</p>
<p>(2)Parent is Red, Uncle is Black. The relationship between GParent and Parent, Parent and Node is same. </p>
<p><img src="https://i.loli.net/2021/06/24/nrmYzwAZdc19yH6.png" alt="RBTree-insert-rebalance2.png"></p>
<p>First we still change parent to black, then change GParent to red like what we did before. The RB tree seemed balance right? But actually GParent-Uncle used to have 2 black nodes, and they have only one now. We break the rule 5! The only thing we can do is to rotate parent and GParent to re-arrange the relationship of the subtree. </p>
<p>Does the re-balance over? No.</p>
<p>(3)Parent is Red, Uncle is Black. The relationship between GParent and Parent, Parent and Node is different. </p>
<p><img src="https://i.loli.net/2021/06/24/aeuvXC4MoAlRNjQ.png" alt="RBTree-insert-rebalance3.png"></p>
<p>Oh! Nothing changes! It is because we make Node the GParent’s son right? So the solution is to make the node that we will rotate Black. Be careful that we can’t change the Node black. Do you remember why we set Node red before. What shall we do? Let look back at situation (2). We are lazy, and how about change situation (3) to (2)? Ya, rotate parent and node right?</p>
<p><img src="https://i.loli.net/2021/06/24/k1EKLdy42CgzBwl.png" alt="RBTree-insert-rebalance4.png"></p>
<p>Now we can solve situation (3) like situation (2)! Remember that the parent and node’s relationship is a bit different, if you use pointers to point at node and parent, you may use swap(parent, node) to ‘repair’ the pointers.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertRebalance</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    RBTNode&lt;T&gt; *parent, *grandParent;</span><br><span class="line">    <span class="comment">// Check whether node has parent, and whether the parent is RED.</span></span><br><span class="line">    <span class="comment">// If the parent is black, we don&#x27;t need to change anything. </span></span><br><span class="line">    <span class="keyword">while</span> ((parent = node-&gt;<span class="built_in">getParent</span>()) &amp;&amp; parent-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)&#123;</span><br><span class="line">        grandParent = parent-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        RBTNode&lt;T&gt; *uncle = grandParent-&gt;<span class="built_in">getSon</span>(<span class="keyword">static_cast</span>&lt;RBTRelation&gt;(<span class="number">1</span> - parent-&gt;<span class="built_in">getRelation</span>(grandParent)));</span><br><span class="line">        <span class="comment">// Parent is red and uncle is red, which is situation 1. </span></span><br><span class="line">        <span class="keyword">if</span> (uncle &amp;&amp; uncle-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)&#123;</span><br><span class="line">            uncle-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">            parent-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">            grandParent-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">            node = grandParent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// uncle maybe NULL, but keep in mind that NULL is a black node.</span></span><br><span class="line">        <span class="comment">// This branch is responsible for situation 2 and 3.</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (uncle == <span class="literal">NULL</span> || uncle-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK)&#123;	</span><br><span class="line">            RBTRelation gPRelation = parent-&gt;<span class="built_in">getRelation</span>(grandParent);</span><br><span class="line">            RBTRelation pSRelation = node-&gt;<span class="built_in">getRelation</span>(parent);</span><br><span class="line">            <span class="comment">// Situation 3, and we will adjust it to situation 2.</span></span><br><span class="line">            <span class="keyword">if</span> (gPRelation != pSRelation)&#123;</span><br><span class="line">                <span class="built_in">rotate</span>(root, parent, node);</span><br><span class="line">                <span class="comment">// Remember to wap parent and node!</span></span><br><span class="line">                <span class="built_in">swap</span>(parent, node);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Situation 2.</span></span><br><span class="line">            parent-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">            grandParent-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">            <span class="built_in">rotate</span>(root, grandParent, parent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Set root as black.</span></span><br><span class="line">    root-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>Search is a very basic operation of binary search Tree. As binary search tree has such a property that left sons’ value are smaller than the current node, the right sons’ values are larger than the current node, we can search from the root and compare the value and the current node’s value. If the value is smaller than the current node’s value, go to the left son. Else we go to the right son.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">RBTNode&lt;T&gt; *<span class="title">searchByValue</span><span class="params">(RBTNode&lt;T&gt; *cur, T val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!cur || cur-&gt;<span class="built_in">getValue</span>() == val)&#123;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (val &lt; cur-&gt;<span class="built_in">getValue</span>())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">searchByValue</span>(cur-&gt;<span class="built_in">getSon</span>(LEFT), val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">searchByValue</span>(cur-&gt;<span class="built_in">getSon</span>(RIGHT), val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FindMin-FindMax"><a href="#FindMin-FindMax" class="headerlink" title="FindMin, FindMax"></a>FindMin, FindMax</h3><p>For a subtree, we should be able to find the minimum and maximum element of it. It’s very easy because we just need to search the tree along the left/right node we will find the min/max value of the subtree.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Find the node with minimum value.</span></span><br><span class="line"><span class="function">RBTNode&lt;T&gt; *<span class="title">findMin</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">    <span class="keyword">while</span> (cur-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        cur = cur-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Find the node with maximum value.</span></span><br><span class="line"><span class="function">RBTNode&lt;T&gt; *<span class="title">findMax</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">    <span class="keyword">while</span> (cur-&gt;<span class="built_in">getSon</span>(RIGHT) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        cur = cur-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Successor-Predecessor"><a href="#Successor-Predecessor" class="headerlink" title="Successor, Predecessor"></a>Successor, Predecessor</h3><p>The successor is the smallest node whose value is larger than the current node. The predecessor is the largest node whose value is smaller than the current node. Here I will explain how to get the successor, and you can get predecessor in almost the same way. If a node has right son node, then the minimum node in the right son’s subtree is the successor. If the node doesn’t have right son, we need to check the node’s parent. If the node is the left son of the parent, then the parent is the successor. If the node is the right son of the parent, we need to find the parent of the parent, until we find a node is the left son of its parent. Then the parent is the successor.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">RBTNode&lt;T&gt; *<span class="title">successor</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;<span class="built_in">getSon</span>(RIGHT) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">findMin</span>(node-&gt;<span class="built_in">getSon</span>(RIGHT));</span><br><span class="line">    &#125;</span><br><span class="line">    RBTNode&lt;T&gt; *nxt = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">    RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">    <span class="keyword">while</span> ((nxt != <span class="literal">NULL</span>) &amp;&amp; (cur == nxt-&gt;<span class="built_in">getSon</span>(LEFT)))&#123;</span><br><span class="line">        cur = nxt;</span><br><span class="line">        nxt = nxt-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">RBTNode&lt;T&gt; *<span class="title">predecessor</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">findMax</span>(node-&gt;<span class="built_in">getSon</span>(LEFT));</span><br><span class="line">    &#125;</span><br><span class="line">    RBTNode&lt;T&gt; *nxt = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">    RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">    <span class="keyword">while</span> ((nxt != <span class="literal">NULL</span>) &amp;&amp; (cur == nxt-&gt;<span class="built_in">getSon</span>(RIGHT)))&#123;</span><br><span class="line">        cur = nxt;</span><br><span class="line">        nxt = nxt-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><p>The delete operation is very similar to the delete operation in Binary search tree. We should first find out the node with the value we want to delete, then we should consider the following situation:</p>
<ol>
<li>The node to be deleted is a leaf node. (We can delete it without extra operation).</li>
<li>The node to be deleted has only one son. (We can replace the node with its son, keep in mind that we won’t change the color).</li>
<li>The node to be deleted has two sons. (We need to find out the successor of the node, then replace the node with its successor. Finally we can delete the successor. The successor must have no or only one child as it’s the successor of current node. So it fall into situation 1 or 2).</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeByVal</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node)</span></span>&#123;</span><br><span class="line">    <span class="comment">// If node&#x27;s left and right are both not NULL.</span></span><br><span class="line">    <span class="keyword">if</span> ((node-&gt;getSon[LEFT] != <span class="literal">NULL</span>) &amp;&amp; (node-&gt;getSon[RIGHT] != <span class="literal">NULL</span>))&#123;</span><br><span class="line">        <span class="comment">// Get the successor first</span></span><br><span class="line">        <span class="comment">// The successor is very special here. As we already know node has both left and right sons, the successor must be in the right son&#x27;s subtree.</span></span><br><span class="line">        RBTNode&lt;T&gt; *replace = <span class="built_in">successor</span>(node);</span><br><span class="line">        RBTNode&lt;T&gt; *parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        <span class="comment">// Replace the node with the successor.</span></span><br><span class="line">        <span class="keyword">if</span> (parent)&#123;</span><br><span class="line">            <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(LEFT) == node)&#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(LEFT) = replace;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(RIGHT) = replace;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Make sure to consider the situation of root.</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            root = replace;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// replace is a successor node. Under the premise we mentioned before, it must only has a right son.</span></span><br><span class="line">        RBTNode&lt;T&gt; *succChild = replace-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">        RBTNode&lt;T&gt; *succParent = replace-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        RBTNodeColor color = replace-&gt;<span class="built_in">getRBTNodeColor</span>();</span><br><span class="line">        <span class="keyword">if</span> (succParent == node)&#123;</span><br><span class="line">            succParent == replace;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (succChild)</span><br><span class="line">                succChild-&gt;setParent = succParent;</span><br><span class="line">            succParent-&gt;<span class="built_in">setSon</span>(LEFT) = succChild;</span><br><span class="line">            replace-&gt;<span class="built_in">setSon</span>(RIGHT) = node-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">            node-&gt;<span class="built_in">getSon</span>(RIGHT)-&gt;<span class="built_in">setParent</span>(replace);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Put replace into the position of node.</span></span><br><span class="line">        replace-&gt;<span class="built_in">setParent</span>(node-&gt;<span class="built_in">getParent</span>());</span><br><span class="line">        replace-&gt;<span class="built_in">setRBTNodeColor</span>(node-&gt;<span class="built_in">getRBTNodeColor</span>());</span><br><span class="line">        replace-&gt;<span class="built_in">setSon</span>(LEFT) = node-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">        node-&gt;<span class="built_in">getSon</span>(LEFT)-&gt;<span class="built_in">setParent</span>(replace);</span><br><span class="line">        <span class="keyword">if</span> (color == BLACK)&#123;</span><br><span class="line">            <span class="built_in">removeRebalance</span>(succChild, succParent);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span> node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    RBTNode&lt;T&gt; *child, *parent;</span><br><span class="line">    RBTNodeColor color;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)</span><br><span class="line">        child = node-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        child = node-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">    parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">    color = node-&gt;<span class="built_in">getRBTNodeColor</span>();</span><br><span class="line">    <span class="keyword">if</span> (child)&#123;</span><br><span class="line">        child-&gt;<span class="built_in">setParent</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parent)&#123;</span><br><span class="line">        <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(LEFT) == node)&#123;</span><br><span class="line">            parent-&gt;<span class="built_in">setSon</span>(LEFT) = child;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            parent-&gt;<span class="built_in">setSon</span>(RIGHT) = child;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        root = child;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (color == BLACK)&#123;</span><br><span class="line">        <span class="built_in">removeRebalance</span>(child, parent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>After delete, of course, we need to re-balance the tree. Fortunately, as we delete the successor node, we can make sure that this is a leaf node, which means we don’t need to both re-balance the tree from the node to the root and from the node to the leaf. Great! Now let see we have broken which rules of RB tree:</p>
<ol>
<li>Each of its nodes is either black or red. (YES)</li>
<li>The root node is black. (NO, do you remember that we need to replace the root with the successor node?)</li>
<li>Every leaf node is black. (In the Red-Black tree, the leaf node is a NIL node).(YES)</li>
<li>If a node is red, its child node must be black. (NO, if there is one son, the parent maybe red and the son is red as well).</li>
<li>From any node to its descendant leaf node must have the same number of black nodes. (NO, the same reason as rule 2)</li>
</ol>
<p>Now we know the conflict we need to solve is 2, 4, 5. </p>
<p>For rule 2, we can simply set the root as black to solve it. </p>
<p>For rule 4, the only question is that for the node we want to delete, its parent and its only son may be both red. OK, after replace the node with its only son, just set it black. (Node is black, so we won’t break rule 5 as well!) </p>
<p>So, only question is 5 and only if the node has two sons! Now the question become how to re-balance the successor. If the successor is red, perfect! Delete it won’t break the rule 5. If the successor is black, we need to “add” a black node to the path from the root to the successor node. We can’t insert a node so the only way is to rotate.</p>
<h4 id="1-Successor-is-Black-Sibling-is-Black-Sibling’s-right-son-is-Red"><a href="#1-Successor-is-Black-Sibling-is-Black-Sibling’s-right-son-is-Red" class="headerlink" title="(1) Successor is Black, Sibling is Black, Sibling’s right son is Red"></a>(1) Successor is Black, Sibling is Black, Sibling’s right son is Red</h4><p><img src="https://i.loli.net/2021/06/30/T1DEtHJNeduVsMF.png" alt="RBTree-delete-rebalance1.png"></p>
<p>For such condition, left rotate can make the black nodes on the path from root to successor plus 1. Be careful that it’s possible that P is red and SL is red as well. So we need to set P as Black, but this may cause the number of black nodes change. So the best solution is to swap the color of P and S. Now we need to check rules 5 after the left rotate:</p>
<p>I. The black nodes on the path from root to successor remain the same.</p>
<p>Yes, the S node helps us solve the problem. Now we can delete the successor.</p>
<p>II. The black nodes on the path from root to SL remain the same.</p>
<p>As we swap the color of S and P, so this won’t be a problem. </p>
<p>III. The black nodes on the path from the root to SR remain the same.</p>
<p>As the left node minus 1, we need to change SR into Black.</p>
<p>Now I think you know why we emphasize that SR must be red. When we change a red node into black, we will only break rule 5, and by chance we need to add a black node on this path! As a result, the procedure is:</p>
<ol>
<li><p>Swap the color of parent and sibling.</p>
</li>
<li><p>Set the right son of sibling as black.</p>
</li>
<li><p>Rotate(parent, sibling).</p>
</li>
<li><p>The tree is balanced!</p>
</li>
</ol>
<h4 id="2-Successor-is-Black-Sibling-is-Black-Sibling’s-left-son-is-Red-Sibling’s-right-son-is-Black"><a href="#2-Successor-is-Black-Sibling-is-Black-Sibling’s-left-son-is-Red-Sibling’s-right-son-is-Black" class="headerlink" title="(2) Successor is Black, Sibling is Black, Sibling’s left son is Red, Sibling’s right son is Black."></a>(2) Successor is Black, Sibling is Black, Sibling’s left son is Red, Sibling’s right son is Black.</h4><p><img src="https://i.loli.net/2021/06/30/lisTtoB7Ve2SPxH.png" alt="RBTree-delete-rebalance2.png"></p>
<p>This situation is very similar to (1). A right rotate on(S, SR) , then set SL as black, S as red can change (2) to (1). </p>
<ol>
<li>Set SL as Black.</li>
<li>Set S as Red.</li>
<li>Rotate(S, SR).</li>
<li>Reset sibling of succ.</li>
</ol>
<h4 id="3-Successor-is-Black-Sibling-is-Black-both-of-Sibling’s-sons-are-Black"><a href="#3-Successor-is-Black-Sibling-is-Black-both-of-Sibling’s-sons-are-Black" class="headerlink" title="(3) Successor is Black, Sibling is Black, both of Sibling’s sons are Black."></a>(3) Successor is Black, Sibling is Black, both of Sibling’s sons are Black.</h4><p><img src="https://i.loli.net/2021/06/30/JIXPar5LxScsQ6i.png" alt="RBTree-delete-rebalance3.png"></p>
<p>Here the only thing we can do is to set S as red. Why? We all know that we need to add a black node to the path of successor, but we can do nothing here. So we will solve the problem at the parent. But keep in mind that if we do so, the path from the root to S will have an extra black node! As a result, we need to set S as red.</p>
<h4 id="4-Successor-is-Black-Sibling-is-Red"><a href="#4-Successor-is-Black-Sibling-is-Red" class="headerlink" title="(4) Successor is Black, Sibling is Red"></a>(4) Successor is Black, Sibling is Red</h4><p><img src="https://i.loli.net/2021/07/01/p5DAXYMevbGUSnq.png" alt="RBTree-delete-rebalance4.png"></p>
<p>In situation 1,2 and 3, the sibling node is always black. If we find the sibling node is red, we need to change it into 1,2 and 3. We just need to set sibling as black, set parent as red and rotate(parent, sibling).</p>
<p>OK! Now the re-balance of delete is done! Here is the code.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeRebalance</span><span class="params">(RBTNode&lt;T&gt; *node, RBTNode&lt;T&gt; *parent)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;removeRebalance starts\n&quot;</span>);</span><br><span class="line">    RBTNode&lt;T&gt; *sibling;</span><br><span class="line">    <span class="keyword">while</span> ((!node || node-&gt;<span class="built_in">getRBTNodeColor</span>()) == BLACK &amp;&amp; node != root)&#123;</span><br><span class="line">        RBTRelation relation = node-&gt;<span class="built_in">getRelation</span>(parent);</span><br><span class="line">        RBTRelation oppRelation = <span class="keyword">static_cast</span>&lt;RBTRelation&gt;(<span class="number">1</span> - relation);</span><br><span class="line">        sibling = parent-&gt;<span class="built_in">getSon</span>(oppRelation);</span><br><span class="line">        <span class="comment">// Case.4 If sibling is red</span></span><br><span class="line">        <span class="keyword">if</span> (sibling-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)&#123;</span><br><span class="line">            sibling-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">            parent-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">            <span class="built_in">rotate</span>(root, parent, sibling);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Case.3 If sibling is black, the two sons of sibling is black as well.</span></span><br><span class="line">        <span class="keyword">if</span> ((!sibling-&gt;<span class="built_in">getSon</span>(LEFT) || sibling-&gt;<span class="built_in">getSon</span>(LEFT)-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK) &amp;&amp;</span><br><span class="line">            (!sibling-&gt;<span class="built_in">getSon</span>(RIGHT) || sibling-&gt;<span class="built_in">getSon</span>(RIGHT)-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK))&#123;</span><br><span class="line">            sibling-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">            node = parent;</span><br><span class="line">            parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!sibling-&gt;<span class="built_in">getSon</span>(oppRelation) || sibling-&gt;<span class="built_in">getSon</span>(oppRelation)-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK)&#123;</span><br><span class="line">                sibling-&gt;<span class="built_in">getSon</span>(relation)-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                sibling-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">                <span class="built_in">rotate</span>(root, sibling, sibling-&gt;<span class="built_in">getSon</span>(relation));</span><br><span class="line">                sibling = parent-&gt;<span class="built_in">getSon</span>(oppRelation);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                sibling-&gt;<span class="built_in">setRBTNodeColor</span>(parent-&gt;<span class="built_in">getRBTNodeColor</span>());</span><br><span class="line">                parent-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                sibling-&gt;<span class="built_in">getSon</span>(oppRelation)-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                <span class="built_in">rotate</span>(root, parent, sibling);</span><br><span class="line">                node = root;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node)</span><br><span class="line">        node-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;removeRebalance ends\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK! Now the RB tree is done. Enjoy it.</p>
<h1 id="Full-Version-of-Code-in-C"><a href="#Full-Version-of-Code-in-C" class="headerlink" title="Full Version of Code in C++"></a>Full Version of Code in C++</h1><p>Annotation may be a bit different from the code before.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> DEBUG = <span class="number">1</span>;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RBTNodeColor</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    RED,</span><br><span class="line">    BLACK</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RBTRelation</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    LEFT,</span><br><span class="line">    RIGHT,</span><br><span class="line">    ERROR</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class T should override the operator &lt;,&gt;,==</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T value;</span><br><span class="line">    RBTNodeColor color;</span><br><span class="line">    RBTNode&lt;T&gt; *child[<span class="number">2</span>], *parent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RBTNode</span>(T value, RBTNodeColor color = BLACK, RBTNode&lt;T&gt; *left = <span class="literal">NULL</span>, RBTNode&lt;T&gt; *right = <span class="literal">NULL</span>, RBTNode&lt;T&gt; *parent = <span class="literal">NULL</span>) : <span class="built_in">value</span>(value), <span class="built_in">color</span>(color), <span class="built_in">parent</span>(parent)</span><br><span class="line">    &#123;</span><br><span class="line">        child[<span class="number">0</span>] = left, child[<span class="number">1</span>] = right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">getSon</span><span class="params">(RBTRelation relation)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;child[relation];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setSon</span><span class="params">(RBTNode&lt;T&gt; *node, RBTRelation relation)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;child[relation] = node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">getParent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTNode&lt;T&gt; *parent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNodeColor <span class="title">getRBTNodeColor</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRBTNodeColor</span><span class="params">(RBTNodeColor color)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;color = color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTRelation <span class="title">getRelation</span><span class="params">(RBTNode *parent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(LEFT) == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> LEFT;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(RIGHT) == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> RIGHT;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">T <span class="title">getValue</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This RBTree doesn&#x27;t allow duplicated elements.</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTree</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    RBTNode&lt;T&gt; *root;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node, RBTNode&lt;T&gt; *son)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Rotate Start\n&quot;</span>);</span><br><span class="line">        <span class="comment">/* Initialization:</span></span><br><span class="line"><span class="comment">         *             parent</span></span><br><span class="line"><span class="comment">         *              / (ATTENTION: Maybe left son or right son.)</span></span><br><span class="line"><span class="comment">         *            node</span></span><br><span class="line"><span class="comment">         *           /    \</span></span><br><span class="line"><span class="comment">         *      leftSon    son</span></span><br><span class="line"><span class="comment">         *                /   \</span></span><br><span class="line"><span class="comment">         *            grandSon  ?</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        RBTNode&lt;T&gt; *parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        RBTRelation relation = son-&gt;<span class="built_in">getRelation</span>(node);</span><br><span class="line">        RBTRelation oppRelation = <span class="keyword">static_cast</span>&lt;RBTRelation&gt;(<span class="number">1</span> - relation);</span><br><span class="line">        RBTNode&lt;T&gt; *grandSon = son-&gt;<span class="built_in">getSon</span>(oppRelation);</span><br><span class="line">        node-&gt;<span class="built_in">setSon</span>(grandSon, relation);</span><br><span class="line">        <span class="keyword">if</span> (grandSon != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            grandSon-&gt;<span class="built_in">setParent</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* After the steps before, grandSon is settled.</span></span><br><span class="line"><span class="comment">         *              parent</span></span><br><span class="line"><span class="comment">         *             /</span></span><br><span class="line"><span class="comment">         *           node   &lt;=parent  son</span></span><br><span class="line"><span class="comment">         *           /  \             /     \</span></span><br><span class="line"><span class="comment">         *      leftSon  grandSon        ?</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        son-&gt;<span class="built_in">setParent</span>(parent);</span><br><span class="line">        <span class="keyword">if</span> (parent == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            root = son;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            RBTRelation rRelation = node-&gt;<span class="built_in">getRelation</span>(parent);</span><br><span class="line">            <span class="keyword">if</span> (rRelation == ERROR)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;ERROR: These two nodes are not parent and son.\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(son, rRelation);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         *                  parent</span></span><br><span class="line"><span class="comment">         *                  /</span></span><br><span class="line"><span class="comment">         *             son</span></span><br><span class="line"><span class="comment">         *              /    \</span></span><br><span class="line"><span class="comment">         *           node     ?</span></span><br><span class="line"><span class="comment">         *           /  \ </span></span><br><span class="line"><span class="comment">         *      leftSon  grandSon</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        son-&gt;<span class="built_in">setSon</span>(node, oppRelation);</span><br><span class="line">        node-&gt;<span class="built_in">setParent</span>(son);</span><br><span class="line">        <span class="keyword">if</span> (DEBUG)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Rotate end\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Insert new node</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertNode</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Insert starts\n&quot;</span>);</span><br><span class="line">        RBTNode&lt;T&gt; *parent = <span class="literal">NULL</span>;</span><br><span class="line">        RBTNode&lt;T&gt; *cur = root;</span><br><span class="line">        <span class="comment">// Here we want to find the node where we want to insert.</span></span><br><span class="line">        <span class="keyword">while</span> (cur)</span><br><span class="line">        &#123;</span><br><span class="line">            parent = cur;</span><br><span class="line">            <span class="comment">// Left child&#x27;s value is less than the parent node, right child&#x27;s value is larger than the parent node.</span></span><br><span class="line">            <span class="keyword">if</span> (node-&gt;<span class="built_in">getValue</span>() &lt; cur-&gt;<span class="built_in">getValue</span>())</span><br><span class="line">                cur = cur-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cur = cur-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Here we know the position to insert and also know the parent of the node.</span></span><br><span class="line">        node-&gt;<span class="built_in">setParent</span>(parent);</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (node-&gt;<span class="built_in">getValue</span>() &lt; parent-&gt;<span class="built_in">getValue</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(node, LEFT);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(node, RIGHT);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Don&#x27;t forget the condition that the RBtree is NULL.</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            root = node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* When we are inserting a new node, we should always set it RED.</span></span><br><span class="line"><span class="comment">         * Considering the rules of RBTree:</span></span><br><span class="line"><span class="comment">         * 1. Each of its node is either black or red.(√. We won&#x27;t break it)</span></span><br><span class="line"><span class="comment">         * 2. The root node is always black.(×.If the tree isn&#x27;t NULL, the insert operation won&#x27;t affect the root node. </span></span><br><span class="line"><span class="comment">         * If the tree is NULL, the root is RED. So we need to fix it in the rebalance operation)</span></span><br><span class="line"><span class="comment">         * 3. Every leaf node is black.(√. We won&#x27;t break it)</span></span><br><span class="line"><span class="comment">         * 4. If a node is red, its child node must be black.(×. If the parent node is red, we may break this rule)</span></span><br><span class="line"><span class="comment">         * 5. From any node to its descendant leaf node must have the same number of black nodes. </span></span><br><span class="line"><span class="comment">         * (√. The node we insert is red, this operation won&#x27;t make the number of black nodes change)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        node-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">        <span class="built_in">insertRebalance</span>(root, node);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Insert ends\n&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertRebalance</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RBTNode&lt;T&gt; *parent, *grandParent;</span><br><span class="line">        <span class="keyword">while</span> ((parent = node-&gt;<span class="built_in">getParent</span>()) &amp;&amp; parent-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)</span><br><span class="line">        &#123;</span><br><span class="line">            grandParent = parent-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">            RBTNode&lt;T&gt; *uncle = grandParent-&gt;<span class="built_in">getSon</span>(<span class="keyword">static_cast</span>&lt;RBTRelation&gt;(<span class="number">1</span> - parent-&gt;<span class="built_in">getRelation</span>(grandParent)));</span><br><span class="line">            <span class="keyword">if</span> (uncle &amp;&amp; uncle-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)</span><br><span class="line">            &#123;</span><br><span class="line">                uncle-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                parent-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                grandParent-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">                node = grandParent;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (uncle == <span class="literal">NULL</span> || uncle-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK)</span><br><span class="line">            &#123;</span><br><span class="line">                RBTRelation gPRelation = parent-&gt;<span class="built_in">getRelation</span>(grandParent);</span><br><span class="line">                RBTRelation pSRelation = node-&gt;<span class="built_in">getRelation</span>(parent);</span><br><span class="line">                <span class="keyword">if</span> (gPRelation != pSRelation)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">rotate</span>(root, parent, node);</span><br><span class="line">                    <span class="built_in">swap</span>(parent, node);</span><br><span class="line">                &#125;</span><br><span class="line">                parent-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                grandParent-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">                <span class="built_in">rotate</span>(root, grandParent, parent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        root-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// Find the node with minimum value.</span></span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">findMin</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">        <span class="keyword">while</span> (cur-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cur = cur-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Find the node with maximum value.</span></span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">findMax</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">        <span class="keyword">while</span> (cur-&gt;<span class="built_in">getSon</span>(RIGHT) != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cur = cur-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">successor</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;<span class="built_in">getSon</span>(RIGHT) != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">findMin</span>(node-&gt;<span class="built_in">getSon</span>(RIGHT));</span><br><span class="line">        &#125;</span><br><span class="line">        RBTNode&lt;T&gt; *nxt = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">        <span class="keyword">while</span> ((nxt != <span class="literal">NULL</span>) &amp;&amp; (cur == nxt-&gt;<span class="built_in">getSon</span>(LEFT)))</span><br><span class="line">        &#123;</span><br><span class="line">            cur = nxt;</span><br><span class="line">            nxt = nxt-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">predecessor</span><span class="params">(RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">findMax</span>(node-&gt;<span class="built_in">getSon</span>(LEFT));</span><br><span class="line">        &#125;</span><br><span class="line">        RBTNode&lt;T&gt; *nxt = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        RBTNode&lt;T&gt; *cur = node;</span><br><span class="line">        <span class="keyword">while</span> ((nxt != <span class="literal">NULL</span>) &amp;&amp; (cur == nxt-&gt;<span class="built_in">getSon</span>(RIGHT)))</span><br><span class="line">        &#123;</span><br><span class="line">            cur = nxt;</span><br><span class="line">            nxt = nxt-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">searchByValue</span><span class="params">(RBTNode&lt;T&gt; *cur, T val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!cur || cur-&gt;<span class="built_in">getValue</span>() == val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (val &lt; cur-&gt;<span class="built_in">getValue</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">searchByValue</span>(cur-&gt;<span class="built_in">getSon</span>(LEFT), val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">searchByValue</span>(cur-&gt;<span class="built_in">getSon</span>(RIGHT), val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeByVal</span><span class="params">(RBTNode&lt;T&gt; *&amp;root, RBTNode&lt;T&gt; *node)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// If node&#x27;s left and right are both not NULL.</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Remove starts\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ((node-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>) &amp;&amp; (node-&gt;<span class="built_in">getSon</span>(RIGHT) != <span class="literal">NULL</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Situation of node has two sons.\n&quot;</span>);</span><br><span class="line">            RBTNode&lt;T&gt; *replace = <span class="built_in">successor</span>(node);</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Successor is:&quot;</span> &lt;&lt; replace-&gt;<span class="built_in">getValue</span>() &lt;&lt; endl;</span><br><span class="line">            RBTNode&lt;T&gt; *parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">            <span class="keyword">if</span> (parent)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(LEFT) == node)</span><br><span class="line">                &#123;</span><br><span class="line">                    parent-&gt;<span class="built_in">setSon</span>(replace, LEFT);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    parent-&gt;<span class="built_in">setSon</span>(replace, RIGHT);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                root = replace;</span><br><span class="line">            &#125;</span><br><span class="line">            RBTNode&lt;T&gt; *succChild = replace-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">            RBTNode&lt;T&gt; *succParent = replace-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">            RBTNodeColor color = replace-&gt;<span class="built_in">getRBTNodeColor</span>();</span><br><span class="line">            <span class="keyword">if</span> (succParent == node)</span><br><span class="line">            &#123;</span><br><span class="line">                succParent = replace;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (succChild)</span><br><span class="line">                    succChild-&gt;<span class="built_in">setParent</span>(succParent);</span><br><span class="line">                succParent-&gt;<span class="built_in">setSon</span>(succChild, LEFT);</span><br><span class="line">                replace-&gt;<span class="built_in">setSon</span>(node-&gt;<span class="built_in">getSon</span>(RIGHT), RIGHT);</span><br><span class="line">                node-&gt;<span class="built_in">getSon</span>(RIGHT)-&gt;<span class="built_in">setParent</span>(replace);</span><br><span class="line">            &#125;</span><br><span class="line">            replace-&gt;<span class="built_in">setParent</span>(node-&gt;<span class="built_in">getParent</span>());</span><br><span class="line">            replace-&gt;<span class="built_in">setRBTNodeColor</span>(node-&gt;<span class="built_in">getRBTNodeColor</span>());</span><br><span class="line">            replace-&gt;<span class="built_in">setSon</span>(node-&gt;<span class="built_in">getSon</span>(LEFT), LEFT);</span><br><span class="line">            node-&gt;<span class="built_in">getSon</span>(LEFT)-&gt;<span class="built_in">setParent</span>(replace);</span><br><span class="line">            <span class="keyword">if</span> (color == BLACK)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">removeRebalance</span>(succChild, succParent);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">delete</span> node;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        RBTNode&lt;T&gt; *child, *parent;</span><br><span class="line">        RBTNodeColor color;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)</span><br><span class="line">            child = node-&gt;<span class="built_in">getSon</span>(LEFT);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            child = node-&gt;<span class="built_in">getSon</span>(RIGHT);</span><br><span class="line">        parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">        color = node-&gt;<span class="built_in">getRBTNodeColor</span>();</span><br><span class="line">        <span class="keyword">if</span> (child)</span><br><span class="line">        &#123;</span><br><span class="line">            child-&gt;<span class="built_in">setParent</span>(parent);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (parent)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (parent-&gt;<span class="built_in">getSon</span>(LEFT) == node)</span><br><span class="line">            &#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(child, LEFT);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                parent-&gt;<span class="built_in">setSon</span>(child, RIGHT);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            root = child;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (color == BLACK)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">removeRebalance</span>(child, parent);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeRebalance</span><span class="params">(RBTNode&lt;T&gt; *node, RBTNode&lt;T&gt; *parent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;removeRebalance starts\n&quot;</span>);</span><br><span class="line">        RBTNode&lt;T&gt; *sibling;</span><br><span class="line">        <span class="keyword">while</span> ((!node || node-&gt;<span class="built_in">getRBTNodeColor</span>()) == BLACK &amp;&amp; node != root)</span><br><span class="line">        &#123;</span><br><span class="line">            RBTRelation relation = node-&gt;<span class="built_in">getRelation</span>(parent);</span><br><span class="line">            RBTRelation oppRelation = <span class="keyword">static_cast</span>&lt;RBTRelation&gt;(<span class="number">1</span> - relation);</span><br><span class="line">            sibling = parent-&gt;<span class="built_in">getSon</span>(oppRelation);</span><br><span class="line">            <span class="comment">// Case.4 If sibling is red</span></span><br><span class="line">            <span class="keyword">if</span> (sibling-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)</span><br><span class="line">            &#123;</span><br><span class="line">                sibling-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                parent-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">                <span class="built_in">rotate</span>(root, parent, sibling);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Case.3 If sibling is black, the two sons of sibling is black as well.</span></span><br><span class="line">            <span class="keyword">if</span> ((!sibling-&gt;<span class="built_in">getSon</span>(LEFT) || sibling-&gt;<span class="built_in">getSon</span>(LEFT)-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK) &amp;&amp;</span><br><span class="line">                (!sibling-&gt;<span class="built_in">getSon</span>(RIGHT) || sibling-&gt;<span class="built_in">getSon</span>(RIGHT)-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK))</span><br><span class="line">            &#123;</span><br><span class="line">                sibling-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">                node = parent;</span><br><span class="line">                parent = node-&gt;<span class="built_in">getParent</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!sibling-&gt;<span class="built_in">getSon</span>(oppRelation) || sibling-&gt;<span class="built_in">getSon</span>(oppRelation)-&gt;<span class="built_in">getRBTNodeColor</span>() == BLACK)</span><br><span class="line">                &#123;</span><br><span class="line">                    sibling-&gt;<span class="built_in">getSon</span>(relation)-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                    sibling-&gt;<span class="built_in">setRBTNodeColor</span>(RED);</span><br><span class="line">                    <span class="built_in">rotate</span>(root, sibling, sibling-&gt;<span class="built_in">getSon</span>(relation));</span><br><span class="line">                    sibling = parent-&gt;<span class="built_in">getSon</span>(oppRelation);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    sibling-&gt;<span class="built_in">setRBTNodeColor</span>(parent-&gt;<span class="built_in">getRBTNodeColor</span>());</span><br><span class="line">                    parent-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                    sibling-&gt;<span class="built_in">getSon</span>(oppRelation)-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">                    <span class="built_in">rotate</span>(root, parent, sibling);</span><br><span class="line">                    node = root;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node)</span><br><span class="line">            node-&gt;<span class="built_in">setRBTNodeColor</span>(BLACK);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;removeRebalance ends\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Construction Function</span></span><br><span class="line">    <span class="built_in">RBTree</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        root = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// insert Key into RBTree</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(T value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RBTNode&lt;T&gt; *newNode = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> ((newNode = <span class="keyword">new</span> RBTNode&lt;T&gt;(value)) == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Create Node Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">insertNode</span>(<span class="keyword">this</span>-&gt;root, newNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RBTNode&lt;T&gt; *cur = root;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">preOrder</span>(cur) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">preOrder</span><span class="params">(RBTNode&lt;T&gt; *cur)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cur == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        string ret = <span class="string">&quot;(&quot;</span>;</span><br><span class="line">        ret += <span class="built_in">to_string</span>(cur-&gt;<span class="built_in">getValue</span>());</span><br><span class="line">        <span class="keyword">if</span> (cur-&gt;<span class="built_in">getRBTNodeColor</span>() == RED)</span><br><span class="line">            ret += <span class="string">&quot; RED&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ret += <span class="string">&quot; BLACK&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (cur-&gt;<span class="built_in">getSon</span>(LEFT) != <span class="literal">NULL</span>)</span><br><span class="line">            ret = ret + <span class="string">&quot;LEFT:&quot;</span> + <span class="built_in">preOrder</span>(cur-&gt;<span class="built_in">getSon</span>(LEFT));</span><br><span class="line">        <span class="keyword">if</span> (cur-&gt;<span class="built_in">getSon</span>(RIGHT) != <span class="literal">NULL</span>)</span><br><span class="line">            ret = ret + <span class="string">&quot;RIGHT:&quot;</span> + <span class="built_in">preOrder</span>(cur-&gt;<span class="built_in">getSon</span>(RIGHT));</span><br><span class="line">        ret += <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTNode&lt;T&gt; *<span class="title">search</span><span class="params">(T val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">searchByValue</span>(root, val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(T value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        RBTNode&lt;T&gt; *node;</span><br><span class="line">        <span class="keyword">if</span> ((node = <span class="built_in">search</span>(value)) != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">removeByVal</span>(root, node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Can&#x27;t find the value in the RB tree!\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Test our rb Tree here!</span></span><br><span class="line">    RBTree&lt;<span class="keyword">int</span>&gt; rbTree;</span><br><span class="line">    <span class="keyword">int</span> oper, value;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; oper)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span> (oper)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// Test insert</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            cin &gt;&gt; value;</span><br><span class="line">            rbTree.<span class="built_in">insert</span>(value);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// Test delete</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            cin &gt;&gt; value;</span><br><span class="line">            rbTree.<span class="built_in">remove</span>(value);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// Test find</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            cin &gt;&gt; value;</span><br><span class="line">            RBTNode&lt;<span class="keyword">int</span>&gt; *node = rbTree.<span class="built_in">search</span>(value);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Print tree in preorder.</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;------------------\n&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Print RBTree begin\n&quot;</span>);</span><br><span class="line">            rbTree.<span class="built_in">print</span>();</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Print RBTree end\n&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;------------------\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Oops, operation can&#x27;t be recognized.\n&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Test-Cases"><a href="#Test-Cases" class="headerlink" title="Test Cases"></a>Test Cases</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1 10</span><br><span class="line">1 40</span><br><span class="line">1 30</span><br><span class="line">1 60</span><br><span class="line">1 90</span><br><span class="line">1 70</span><br><span class="line">1 20</span><br><span class="line">1 50</span><br><span class="line">1 80</span><br><span class="line">4</span><br><span class="line">Output: </span><br><span class="line">(30 BLACK LEFT:(10 BLACK RIGHT:(20 RED))RIGHT:(60 RED LEFT:(40 BLACK RIGHT:(50 RED))RIGHT:(80 BLACK LEFT:(70 RED)RIGHT:(90 RED))))</span><br><span class="line">2 30</span><br><span class="line">Output:</span><br><span class="line">Situation of node has two sons.</span><br><span class="line">Successor is:40</span><br><span class="line">4</span><br><span class="line">Output:</span><br><span class="line">(40 BLACKLEFT:(10 BLACKRIGHT:(20 RED))RIGHT:(60 REDLEFT:(50 BLACK)RIGHT:(80 BLACKLEFT:(70 RED)RIGHT:(90 RED))))</span><br><span class="line">2 10</span><br><span class="line">4</span><br><span class="line">(40 BLACKLEFT:(20 BLACK)RIGHT:(60 REDLEFT:(50 BLACK)RIGHT:(80 BLACKLEFT:(70 RED)RIGHT:(90 RED))))</span><br></pre></td></tr></table></figure>





<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/skywang12345/p/3245399.html">The red-black tree: Introduction and algorithm</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/skywang12345/p/3624291.html">The red-black tree: Implement of C++</a><br>Introduction of Algorithm(The third edition)<br><a target="_blank" rel="noopener" href="https://www.programiz.com/dsa/deletion-from-a-red-black-tree">Deletion From a Red-Black Tree</a></p>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" rel="tag"># 红黑树</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/04/24/%E9%87%8D%E5%AD%A6%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/" rel="next" title="Relearn Front End Technology">
                <i class="fa fa-chevron-left"></i> Relearn Front End Technology
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/07/31/View%E7%9A%84%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0-Android/" rel="prev" title="View的动态添加-Android">
                View的动态添加-Android <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
	<div id="gitalk-container"></div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://i.loli.net/2020/12/14/8mG9PknVTAeH4cf.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">87</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">59</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ManuShi98" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:shizihong98@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/numberer" title="numberer" target="_blank">numberer</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#An-Implementation-of-the-Red-Black-tree-in-C"><span class="nav-number">1.</span> <span class="nav-text">An Implementation of the Red-Black tree in C++</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-node-of-the-Red-Black-tree"><span class="nav-number">1.1.</span> <span class="nav-text">The node of the Red-Black tree</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-structure-of-the-node"><span class="nav-number">1.1.1.</span> <span class="nav-text">The structure of the node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-operation-of-the-node"><span class="nav-number">1.1.2.</span> <span class="nav-text">The operation of the node</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RB-Tree"><span class="nav-number">1.2.</span> <span class="nav-text">RB Tree</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rotate"><span class="nav-number">1.2.1.</span> <span class="nav-text">Rotate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insert"><span class="nav-number">1.2.2.</span> <span class="nav-text">Insert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Search"><span class="nav-number">1.2.3.</span> <span class="nav-text">Search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FindMin-FindMax"><span class="nav-number">1.2.4.</span> <span class="nav-text">FindMin, FindMax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Successor-Predecessor"><span class="nav-number">1.2.5.</span> <span class="nav-text">Successor, Predecessor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delete"><span class="nav-number">1.2.6.</span> <span class="nav-text">Delete</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Successor-is-Black-Sibling-is-Black-Sibling%E2%80%99s-right-son-is-Red"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">(1) Successor is Black, Sibling is Black, Sibling’s right son is Red</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Successor-is-Black-Sibling-is-Black-Sibling%E2%80%99s-left-son-is-Red-Sibling%E2%80%99s-right-son-is-Black"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">(2) Successor is Black, Sibling is Black, Sibling’s left son is Red, Sibling’s right son is Black.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Successor-is-Black-Sibling-is-Black-both-of-Sibling%E2%80%99s-sons-are-Black"><span class="nav-number">1.2.6.3.</span> <span class="nav-text">(3) Successor is Black, Sibling is Black, both of Sibling’s sons are Black.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Successor-is-Black-Sibling-is-Red"><span class="nav-number">1.2.6.4.</span> <span class="nav-text">(4) Successor is Black, Sibling is Red</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Full-Version-of-Code-in-C"><span class="nav-number">2.</span> <span class="nav-text">Full Version of Code in C++</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Test-Cases"><span class="nav-number">3.</span> <span class="nav-text">Test Cases</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ManuShi98</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <div id="gitalk-container"></div>
  <script src="/js/src/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: 'fa6d33118e19b15ec39e',
      clientSecret: '4922913e0e8b8940b2233e90f05da307f7c26de6',
      repo: 'blogcomment',
      owner: 'ManuShi98',
      admin: ['ManuShi98'],
      id: md5(location.pathname),
      distractionFreeMode: 'false'
    })
    gitalk.render('gitalk-container')
  </script>

  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

</body>
</html>
